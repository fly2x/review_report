[
  {
    "source": "claude",
    "file": "include/crypto/crypt_errno.h",
    "line": "672-687",
    "severity": "critical",
    "title": "Missing error codes CRYPT_LMS_PAIRWISE_CHECK_FAIL and CRYPT_HSS_PAIRWISE_CHECK_FAIL",
    "problem": "The code in lms_api.c (lines 510, 515, 529) and hss_api.c (lines 439, 445, 455, 471) uses CRYPT_LMS_PAIRWISE_CHECK_FAIL and CRYPT_HSS_PAIRWISE_CHECK_FAIL error codes, but these are not defined in crypt_errno.h. This will cause compilation errors.",
    "code": "CRYPT_HSS_SIGN_FAIL,                         /**< HSS signature generation failed. */\n    CRYPT_HSS_KEYGEN_FAIL,                       /**< HSS key generation failed. */\n};",
    "fix": "CRYPT_HSS_SIGN_FAIL,                         /**< HSS signature generation failed. */\n    CRYPT_HSS_KEYGEN_FAIL,                       /**< HSS key generation failed. */\n    CRYPT_LMS_PAIRWISE_CHECK_FAIL,               /**< LMS key pair check failed. */\n    CRYPT_HSS_PAIRWISE_CHECK_FAIL,               /**< HSS key pair check failed. */\n};"
  },
  {
    "source": "claude",
    "file": "crypto/lms/src/lms_api.c",
    "line": "118-120",
    "severity": "medium",
    "title": "libCtx field not copied in CRYPT_LMS_DupCtx",
    "problem": "The CRYPT_LMS_DupCtx function does not copy the libCtx field from the source context. The duplicated context will always have libCtx = NULL, even if the source context had a valid library context pointer. This can cause issues when the duplicated context is used with provider APIs that rely on libCtx.",
    "code": "ctx->signatureIndex = srcCtx->signatureIndex;\n\n    return ctx;\n}",
    "fix": "ctx->signatureIndex = srcCtx->signatureIndex;\n    ctx->libCtx = srcCtx->libCtx;\n\n    return ctx;\n}"
  },
  {
    "source": "claude",
    "file": "crypto/lms/src/hss_api.c",
    "line": "121-123",
    "severity": "medium",
    "title": "libCtx field not copied in CRYPT_HSS_DupCtx",
    "problem": "The CRYPT_HSS_DupCtx function does not copy the libCtx field from the source context. The duplicated context will always have libCtx = NULL, even if the source context had a valid library context pointer. This can cause issues when the duplicated context is used with provider APIs that rely on libCtx.",
    "code": "// Copy state\n    newCtx->signatureIndex = srcCtx->signatureIndex;\n\n    return newCtx;\n}",
    "fix": "// Copy state\n    newCtx->signatureIndex = srcCtx->signatureIndex;\n    newCtx->libCtx = srcCtx->libCtx;\n\n    return newCtx;\n}"
  },
  {
    "source": "claude",
    "file": "crypto/lms/src/hss_api.c",
    "line": "91-92",
    "severity": "low",
    "title": "Context structure not zeroized before free in CRYPT_HSS_FreeCtx",
    "problem": "Unlike CRYPT_LMS_FreeCtx which zeroizes the ctx structure before freeing, CRYPT_HSS_FreeCtx does not zeroize the ctx structure. The ctx structure contains signatureIndex which may be considered sensitive state information. For consistency with LMS and proper secure cleanup, ctx should be zeroized.",
    "code": "if (ctx->para != NULL) {\n        LmsZeroize(ctx->para, sizeof(HSS_Para));\n        BSL_SAL_Free(ctx->para);\n    }\n\n    BSL_SAL_Free(ctx);\n}",
    "fix": "if (ctx->para != NULL) {\n        LmsZeroize(ctx->para, sizeof(HSS_Para));\n        BSL_SAL_Free(ctx->para);\n    }\n\n    LmsZeroize(ctx, sizeof(CRYPT_HSS_Ctx));\n    BSL_SAL_Free(ctx);\n}"
  },
  {
    "source": "claude",
    "file": "crypto/provider/src/cmvp/cmvp_utils/cmvp_selftest_lms.c",
    "line": "45-48",
    "severity": "low",
    "title": "Magic numbers used for control commands instead of defined constants",
    "problem": "The selftest code uses magic numbers 1 and 2 for CRYPT_EAL_PkeyCtrl calls instead of the defined symbolic constants CRYPT_CTRL_LMS_SET_TYPE and CRYPT_CTRL_LMS_SET_OTS_TYPE. This makes the code harder to maintain and could break if the control command values change.",
    "code": "uint32_t lmsType = 5;  // LMS_SHA256_M32_H5\n    uint32_t otsType = 4;  // LMOTS_SHA256_N32_W8\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, 1, &lmsType, sizeof(lmsType)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, 2, &otsType, sizeof(otsType)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);",
    "fix": "uint32_t lmsType = LMS_SHA256_M32_H5;\n    uint32_t otsType = LMOTS_SHA256_N32_W8;\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, CRYPT_CTRL_LMS_SET_TYPE, &lmsType, sizeof(lmsType)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, CRYPT_CTRL_LMS_SET_OTS_TYPE, &otsType, sizeof(otsType)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);"
  },
  {
    "source": "claude",
    "file": "crypto/provider/src/cmvp/cmvp_utils/cmvp_selftest_hss.c",
    "line": "48-58",
    "severity": "low",
    "title": "Magic numbers used for control commands instead of defined constants",
    "problem": "The selftest code uses magic numbers 1, 2, and 3 for CRYPT_EAL_PkeyCtrl calls instead of the defined symbolic constants CRYPT_CTRL_HSS_SET_LEVELS, CRYPT_CTRL_HSS_SET_LMS_TYPE, and CRYPT_CTRL_HSS_SET_OTS_TYPE. This makes the code harder to maintain and could break if the control command values change.",
    "code": "GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, 1, &levels, sizeof(levels)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, 2, lmsParams, sizeof(lmsParams)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, 3, otsParams, sizeof(otsParams)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);",
    "fix": "GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, CRYPT_CTRL_HSS_SET_LEVELS, &levels, sizeof(levels)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, CRYPT_CTRL_HSS_SET_LMS_TYPE, lmsParams, sizeof(lmsParams)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);\n    GOTO_ERR_IF_TRUE(CRYPT_EAL_PkeyCtrl(pkey, CRYPT_CTRL_HSS_SET_OTS_TYPE, otsParams, sizeof(otsParams)) != CRYPT_SUCCESS,\n        CRYPT_CMVP_ERR_ALGO_SELFTEST);"
  }
]