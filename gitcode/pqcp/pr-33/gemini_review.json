[
  {
    "source": "gemini",
    "file": "CMakeLists.txt",
    "line": "98",
    "severity": "high",
    "title": "Inclusion of non-existent directory",
    "problem": "The build configuration includes `${CMAKE_CURRENT_SOURCE_DIR}/src/hybrid_env/include`, but this directory does not exist in the source tree. This causes build errors or warnings.",
    "code": "target_include_directories(pqcp_provider\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/classic_mceliece/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/frodokem/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/polarlac/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/hybrid_env/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/composite_sign/include\n        ${OPENHITLS_INCLUDE_DIRS}",
    "fix": "target_include_directories(pqcp_provider\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/classic_mceliece/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/frodokem/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/polarlac/include\n        ${CMAKE_CURRENT_SOURCE_DIR}/src/composite_sign/include\n        ${OPENHITLS_INCLUDE_DIRS}"
  },
  {
    "source": "gemini",
    "file": "test/CMakeLists.txt",
    "line": "92-93",
    "severity": "high",
    "title": "Inclusion of non-existent directory",
    "problem": "The test build configuration includes `hybrid_env` directories that do not exist.",
    "code": "${CMAKE_SOURCE_DIR}/../platform/openhitls/platform/Secure_C/include\n    ${CMAKE_SOURCE_DIR}/../src/hybrid_env/include\n    ${CMAKE_SOURCE_DIR}/../src/hybrid_env/src\n    ${CMAKE_SOURCE_DIR}/../src/composite_sign/include",
    "fix": "${CMAKE_SOURCE_DIR}/../platform/openhitls/platform/Secure_C/include\n    ${CMAKE_SOURCE_DIR}/../src/composite_sign/include"
  },
  {
    "source": "gemini",
    "file": "src/composite_sign/src/crypt_composite_sign.c",
    "line": "320-321",
    "severity": "medium",
    "title": "Ignored return value of secure memory copy",
    "problem": "The return values of `memcpy_s` are explicitly cast to `void`. Ignoring the error code hides potential failures (e.g. invalid arguments) and violates secure coding standards.",
    "code": "(void)memcpy_s(prv->data, prv->len, pqcPrv.data, pqcPrv.dataLen);\n    (void)memcpy_s(prv->data + pqcPrv.dataLen, prv->len - pqcPrv.dataLen, tradPrv.data, tradPrv.dataLen);",
    "fix": "if (memcpy_s(prv->data, prv->len, pqcPrv.data, pqcPrv.dataLen) != EOK) {\n        ret = CRYPT_MEM_ALLOC_FAIL; // Or appropriate error code\n        goto ERR;\n    }\n    if (memcpy_s(prv->data + pqcPrv.dataLen, prv->len - pqcPrv.dataLen, tradPrv.data, tradPrv.dataLen) != EOK) {\n        ret = CRYPT_MEM_ALLOC_FAIL;\n        goto ERR;\n    }"
  },
  {
    "source": "gemini",
    "file": "src/composite_sign/src/crypt_composite_sign.c",
    "line": "343-344",
    "severity": "medium",
    "title": "Ignored return value of secure memory copy",
    "problem": "The return values of `memcpy_s` are explicitly cast to `void`.",
    "code": "(void)memcpy_s(pub->data, pub->len, pqcPub.data, pqcPub.dataLen);\n    (void)memcpy_s(pub->data + pqcPub.dataLen, pub->len - pqcPub.dataLen, tradPub.data, tradPub.dataLen);",
    "fix": "if (memcpy_s(pub->data, pub->len, pqcPub.data, pqcPub.dataLen) != EOK) {\n        ret = CRYPT_MEM_ALLOC_FAIL;\n        goto ERR;\n    }\n    if (memcpy_s(pub->data + pqcPub.dataLen, pub->len - pqcPub.dataLen, tradPub.data, tradPub.dataLen) != EOK) {\n        ret = CRYPT_MEM_ALLOC_FAIL;\n        goto ERR;\n    }"
  },
  {
    "source": "gemini",
    "file": "src/composite_sign/src/crypt_composite_sign.c",
    "line": "466-476",
    "severity": "medium",
    "title": "Ignored return value of secure memory copy",
    "problem": "Multiple `memcpy_s` calls in `CompositeMsgEncode` ignore the return value.",
    "code": "(void)memcpy_s(ptr, msg->len, PREFIX, prefixLen);\n    ptr += prefixLen;\n    (void)memcpy_s(ptr, msg->len - prefixLen, label, labelLen);\n    ptr += labelLen;\n    *ptr = ctx->ctxLen;\n    ptr++;\n    if (ctx->ctxInfo != NULL && ctx->ctxLen > 0) {\n        (void)memcpy_s(ptr, msg->len - (prefixLen + labelLen + 1), ctx->ctxInfo, ctx->ctxLen);\n        ptr += ctx->ctxLen;\n    }\n    (void)memcpy_s(ptr, digestLen, digest, digestLen);",
    "fix": "if (memcpy_s(ptr, msg->len, PREFIX, prefixLen) != EOK) return CRYPT_MEM_ALLOC_FAIL;\n    ptr += prefixLen;\n    if (memcpy_s(ptr, msg->len - prefixLen, label, labelLen) != EOK) return CRYPT_MEM_ALLOC_FAIL;\n    ptr += labelLen;\n    *ptr = ctx->ctxLen;\n    ptr++;\n    if (ctx->ctxInfo != NULL && ctx->ctxLen > 0) {\n        if (memcpy_s(ptr, msg->len - (prefixLen + labelLen + 1), ctx->ctxInfo, ctx->ctxLen) != EOK) return CRYPT_MEM_ALLOC_FAIL;\n        ptr += ctx->ctxLen;\n    }\n    if (memcpy_s(ptr, digestLen, digest, digestLen) != EOK) return CRYPT_MEM_ALLOC_FAIL;"
  },
  {
    "source": "gemini",
    "file": "test/demo/composite_sign_demo.c",
    "line": "27",
    "severity": "medium",
    "title": "Insufficient buffer size for MLDSA-87 signatures",
    "problem": "`signData` buffer is 4096 bytes. MLDSA-87 composite signatures require > 4600 bytes. If the algorithm is changed to MLDSA-87, this buffer will overflow.",
    "code": "uint8_t signData[4096];",
    "fix": "uint8_t signData[5000];"
  },
  {
    "source": "gemini",
    "file": "src/composite_sign/src/crypt_composite_sign.c",
    "line": "211",
    "severity": "low",
    "title": "Function naming inconsistency",
    "problem": "`CRYPT_CompositeSetctxInfo` uses lowercase `ctx` in the name, inconsistent with `CRYPT_CompositeSetAlgInfo` and standard CamelCase convention.",
    "code": "static int32_t CRYPT_CompositeSetctxInfo(CRYPT_CompositeCtx *ctx, void *val, uint32_t len)",
    "fix": "static int32_t CRYPT_CompositeSetCtxInfo(CRYPT_CompositeCtx *ctx, void *val, uint32_t len)"
  },
  {
    "source": "gemini",
    "file": "src/composite_sign/src/crypt_composite_sign_local.h",
    "line": "43",
    "severity": "low",
    "title": "Typo in comment",
    "problem": "`composiet` is misspelled.",
    "code": "uint32_t compPrvKeyLen; // composiet prvkey len",
    "fix": "uint32_t compPrvKeyLen; // composite prvkey len"
  }
]