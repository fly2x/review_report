[
  {
    "source": "gemini",
    "file": "apps/src/app_tls_common.c",
    "line": "370",
    "severity": "high",
    "title": "Potential NULL pointer dereference",
    "problem": "The code dereferences `certConfig->smParam` to access `smTag` without checking if `smParam` is NULL. If `HITLS_APP_SM_MODE` is enabled but `smParam` is not initialized (e.g. in non-SM modes or partial config), this will cause a crash.",
    "code": "if (!isSignKey && certConfig->smParam->smTag == 1) {\n        pkey = LoadEncKeyBySignKey(certConfig);",
    "fix": "if (!isSignKey && certConfig->smParam != NULL && certConfig->smParam->smTag == 1) {\n        pkey = LoadEncKeyBySignKey(certConfig);"
  },
  {
    "source": "gemini",
    "file": "apps/src/app_tls_common.c",
    "line": "292",
    "severity": "medium",
    "title": "Ignored return value of BSL_PARAM_InitValue",
    "problem": "The return value of `BSL_PARAM_InitValue` is explicitly cast to void and ignored. If initialization fails (e.g. invalid arguments), `prvParam` will be incorrectly initialized, potentially causing `CRYPT_EAL_PkeySetPrvEx` to fail or behave unpredictably.",
    "code": "(void)BSL_PARAM_InitValue(&prvParam[0], CRYPT_PARAM_EC_PRVKEY, BSL_PARAM_TYPE_OCTETS,\n        (void *)plain, plainLen);\n    int32_t ret = CRYPT_EAL_PkeySetPrvEx(encKey, prvParam);",
    "fix": "if (BSL_PARAM_InitValue(&prvParam[0], CRYPT_PARAM_EC_PRVKEY, BSL_PARAM_TYPE_OCTETS,\n        (void *)plain, plainLen) != BSL_SUCCESS) {\n        AppPrintError(\"Failed to init private key param\\n\");\n        CRYPT_EAL_PkeyFreeCtx(encKey);\n        return NULL;\n    }\n    int32_t ret = CRYPT_EAL_PkeySetPrvEx(encKey, prvParam);"
  }
]